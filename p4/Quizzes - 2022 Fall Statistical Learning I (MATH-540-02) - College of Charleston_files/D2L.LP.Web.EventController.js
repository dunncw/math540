D2L.Events={};D2L.Events.Event=D2L.Class.extend({Construct:function(){arguments.callee.$.Construct.call(this);this.Handlers=[];},Raise:function(){for(var i=0;i<this.Handlers.length;i++){if(!this.Handlers[i].Remove){if(this.Handlers[i].Callback){var test=false;try{test=this.Handlers[i].Test.apply();}catch(e){}if(test){var args=this.Handlers[i].Window.UI.CreateArray();for(var j=0;j<arguments.length;j++){args.push(arguments[j]);}this.Handlers[i].Callback.apply(this.Handlers[i].Callback,args);}else{this.Handlers[i].Remove=true;}}else{this.Handlers[i].Remove=true;}}}this.UnregisterHandlers();},UnregisterHandlers:function(){this.Cleanup();},Cleanup:function(){var HandlerSort=function(h1,h2){if(h1.Remove&&h2.Remove){return 0;}else if(!h1.Remove&&!h2.Remove){return 0;}else if(h1.Remove&&!h2.Remove){return 1;}else{return-1;}};this.Handlers.sort(HandlerSort);for(var i=this.Handlers.length-1;i>=0;i--){if(this.Handlers[i].Remove){this.Handlers.pop();}}},Unregister:function(win){for(var i=0;i<this.Handlers.length;i++){if(this.Handlers[i].Window===win){this.Handlers[i].Remove=true;}}this.Cleanup();},Register:function(w,callback){if(w&&w[callback]){this.Handlers.push({Window:w,Callback:w[callback],Test:w.UI.Test,Remove:false});}}});D2L.Events.EventController=D2L.Class.extend({Construct:function(){arguments.callee.$.Construct.call(this,true);},Dispose:function(){arguments.callee.$.Dispose.call(this);},CreateEvent:function(eventName){this[eventName]=new D2L.Events.Event(eventName);},RegisterEventCallback:function(eventName,w,callback){if(this[eventName]){this[eventName].Register(w,callback);}},UnregisterEvent:function(eventName,w){if(this[eventName]){this[eventName].Unregister(w);}}});